<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>GreenForce CRM</title>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- SortableJS for drag-and-drop -->
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

  <!-- Tailwind CSS + Heroicons (via single CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#10B981',
            secondary: '#059669',
          }
        }
      },
      plugins: []
    }
  </script>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body class="bg-gray-50 text-gray-800 dark:bg-gray-900 dark:text-gray-200 transition-colors duration-200">
  <!-- Main Layout -->
  <div class="flex h-screen overflow-hidden">
    <!-- Left Sidebar (Main Nav) -->
    <aside id="sidebar" class="w-64 bg-white dark:bg-gray-800 shadow-md fixed md:static h-full z-20 transform -translate-x-full md:translate-x-0 transition-transform duration-300">
      <div class="p-4 border-b border-gray-200 dark:border-gray-700">
        <img src="data/images/gf.png" alt="GreenForce Logo" class="h-10 w-auto mb-4">
      </div>
      <nav class="p-4 space-y-2">
        <a href="#" class="block py-2 px-4 rounded hover:bg-gray-100 dark:hover:bg-gray-700 active-link" data-page="dashboard">ğŸ“Š Dashboard</a>
        <a href="#" class="block py-2 px-4 rounded hover:bg-gray-100 dark:hover:bg-gray-700" data-page="customers">ğŸ‘¥ Customers</a>
        <a href="#" class="block py-2 px-4 rounded hover:bg-gray-100 dark:hover:bg-gray-700" data-page="inventory">ğŸ“¦ Inventory</a>
        <a href="#" class="block py-2 px-4 rounded hover:bg-gray-100 dark:hover:bg-gray-700" data-page="sales">ğŸ’° Sales</a>
        <a href="#" class="block py-2 px-4 rounded hover:bg-gray-100 dark:hover:bg-gray-700" data-page="repairs">ğŸ”§ Repairs</a>
        <a href="#" class="block py-2 px-4 rounded hover:bg-gray-100 dark:hover:bg-gray-700" data-page="delivery">ğŸšš Delivery</a>
        <a href="#" class="block py-2 px-4 rounded hover:bg-gray-100 dark:hover:bg-gray-700" data-page="settings">âš™ï¸ Settings</a>
        <a href="#" class="block py-2 px-4 rounded hover:bg-gray-100 dark:hover:bg-gray-700" data-page="reports">ğŸ“Š Reports</a>
      </nav>
    </aside>

    <!-- Main Content Area -->
    <div class="flex-1 flex flex-col overflow-hidden">
      <!-- Topbar -->
      <header class="bg-white dark:bg-gray-800 shadow-sm p-4">
        <!-- Breadcrumbs -->
        <nav class="text-sm mb-3 text-gray-500 dark:text-gray-400" id="breadcrumbs">
          Dashboard
        </nav>

        <!-- Global Search -->
        <div class="relative max-w-2xl">
          <input
            type="text"
            id="global-search"
            placeholder="Search customers, products, repairs..."
            class="w-full p-2 pl-10 border rounded-lg dark:bg-gray-700 dark:border-gray-600 focus:ring-2 focus:ring-primary focus:outline-none"
          />
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 absolute left-3 top-2.5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
          <div id="search-results" class="absolute z-10 w-full bg-white dark:bg-gray-800 shadow-lg rounded-b-lg hidden mt-1 divide-y divide-gray-200 dark:divide-gray-700"></div>
        </div>

        <!-- User Controls -->
        <div class="flex justify-end items-center mt-3 space-x-4">
          <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700">
            <svg id="theme-icon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
            </svg>
          </button>
<div class="flex items-center space-x-3">
  <div class="relative">
    <img id="user-avatar" src="https://i.pravatar.cc/100?img=1" class="w-8 h-8 rounded-full border-2 border-primary">
    <div class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white"></div>
  </div>
  <div class="hidden md:block">
    <div class="font-medium" id="user-name">Admin User</div>
    <div class="text-xs text-gray-500" id="user-role-badge">Admin</div>
  </div>
</div>
        </div>
      </header>

      <!-- Page Content -->
      <main id="page-content" class="flex-1 overflow-y-auto p-4 bg-gray-50 dark:bg-gray-900 relative">
        <!-- Pages loaded here -->
      </main>
    </div>

  
  <!-- Floating Action Button (FAB) -->
  <button id="fab" class="fixed bottom-6 right-6 w-14 h-14 rounded-full bg-primary text-white shadow-lg hover:bg-secondary flex items-center justify-center z-30 transition-transform hover:scale-110">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
    </svg>
  </button>

  <!-- FAB Menu -->
  <div id="fab-menu" class="fixed bottom-20 right-6 space-y-2 hidden">
    <button onclick="quickAction('customer')" class="w-12 h-12 rounded-full bg-blue-500 text-white shadow flex items-center justify-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
      </svg>
    </button>
    <button onclick="quickAction('sale')" class="w-12 h-12 rounded-full bg-green-500 text-white shadow flex items-center justify-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
    </button>
    <button onclick="quickAction('repair')" class="w-12 h-12 rounded-full bg-purple-500 text-white shadow flex items-center justify-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
      </svg>
    </button>
  </div>

  <!-- Modals -->
  <div id="modal-root"></div>

  <!-- Scripts -->
  <script src="js/auth.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/dashboard.js"></script>
  <script src="js/customers.js"></script>
  <script src="js/inventory.js"></script>
  <script src="js/sales.js"></script>
  <script src="js/repairs.js"></script>
  <script src="js/delivery.js"></script>
  <script src="js/navigation.js"></script>
  <script src="js/reports.js"></script>

  <script>
    // Page routing
    document.querySelectorAll('nav a[data-page]').forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        document.querySelectorAll('nav a').forEach(a => a.classList.remove('active-link'));
        this.classList.add('active-link');

        const page = this.dataset.page;
        switch(page) {
          case 'dashboard': loadDashboard(); break;
          case 'customers': loadCustomersPage(); break;
          case 'inventory': loadInventoryPage(); break;
          case 'reports': loadReportsPage(); break;
          case 'sales': loadSalesPage(); break;
          case 'repairs': loadRepairsPage(); break;
          case 'delivery': loadDeliveryPage(); break;
          case 'settings':
            document.getElementById('page-content').innerHTML = `
              <h2 class="text-2xl font-bold">Settings</h2>
              <p class="mt-4">User Role: <span class="font-semibold">${currentUser.role}</span></p>
              <button onclick="toggleRole()" class="mt-4 bg-primary text-white px-4 py-2 rounded">ğŸ”„ Switch Role (Demo)</button>
            `;
            updateBreadcrumbs('settings');
            break;
          default: loadDashboard();
        }
      });
    });

    function toggleRole() {
      const roles = ['admin', 'sales', 'technician', 'inventory'];
      const current = currentUser.role;
      const next = roles[(roles.indexOf(current) + 1) % roles.length];
      currentUser.role = next;
      currentUser.name = next.charAt(0).toUpperCase() + next.slice(1) + ' User';
      
      document.getElementById('user-role-badge').textContent = currentUser.role.charAt(0).toUpperCase() + currentUser.role.slice(1);
      document.getElementById('user-name').textContent = currentUser.name;
      
      applyRolePermissions();
      
      const activePage = document.querySelector('nav a.active-link')?.dataset.page || 'dashboard';
      document.querySelector(`nav a[data-page="${activePage}"]`)?.click();
    }

    // Initial load
    document.querySelector('nav a[data-page="dashboard"]').click();
  </script>
  <script src="js/navigation.js"></script>
</body>
</html>
